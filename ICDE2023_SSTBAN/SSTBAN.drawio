<mxfile host="app.diagrams.net" modified="2024-07-23T12:55:42.291Z" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.0.0 Safari/537.36 Edg/126.0.0.0" etag="eMiV_TzGcntZx9IUJ0Oe" version="24.7.3" type="github">
  <diagram name="第 1 页" id="VAEvbOEpjss1O71dqnCe">
    <mxGraphModel dx="1280" dy="1411" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="nkDRGLkflmFNne_LrV7g-3" value="his=24 pred=24" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;fontColor=#000000;darkOpacity=0.05;fillColor=#FFF9B2;strokeColor=none;fillStyle=solid;direction=west;gradientDirection=north;gradientColor=#FFF2A1;shadow=1;size=20;pointerEvents=1;" parent="1" vertex="1">
          <mxGeometry x="290" y="50" width="90" height="40" as="geometry" />
        </mxCell>
        <mxCell id="nkDRGLkflmFNne_LrV7g-35" value="trainX（10172， 24， 307， 1）" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="1194" y="90" width="210" height="30" as="geometry" />
        </mxCell>
        <mxCell id="nkDRGLkflmFNne_LrV7g-36" value="trainY（10172， 24， 307， 1）" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="1194" y="130" width="210" height="30" as="geometry" />
        </mxCell>
        <mxCell id="nkDRGLkflmFNne_LrV7g-37" value="trainTE（10172， 48， 2），（dow，tod）" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="1194" y="180" width="280" height="30" as="geometry" />
        </mxCell>
        <mxCell id="nkDRGLkflmFNne_LrV7g-38" value="数据处理data（16992，307，2）2：（流量，日期）" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="100" y="160" width="305" height="30" as="geometry" />
        </mxCell>
        <mxCell id="nkDRGLkflmFNne_LrV7g-39" value="train_set（10195，307，2）" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="150" y="220" width="160" height="30" as="geometry" />
        </mxCell>
        <mxCell id="nkDRGLkflmFNne_LrV7g-40" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="220" y="250" as="sourcePoint" />
            <mxPoint x="220" y="360" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="nkDRGLkflmFNne_LrV7g-41" value="seq2instance_plus（train_set[...:1]，num_his，num_pred）" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="212" y="280" width="340" height="30" as="geometry" />
        </mxCell>
        <mxCell id="nkDRGLkflmFNne_LrV7g-42" value="X（10172，24，307，1）&lt;div&gt;Y（10172，24，307，1）&lt;/div&gt;" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="130" y="370" width="200" height="30" as="geometry" />
        </mxCell>
        <mxCell id="nkDRGLkflmFNne_LrV7g-43" value="time（10195，2）2：（dow，tod）" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="482" y="225" width="198" height="30" as="geometry" />
        </mxCell>
        <mxCell id="nkDRGLkflmFNne_LrV7g-44" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="552" y="255" as="sourcePoint" />
            <mxPoint x="552" y="365" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="nkDRGLkflmFNne_LrV7g-45" value="seq2instance（time，num_his，num_pred）" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="552" y="265" width="258" height="30" as="geometry" />
        </mxCell>
        <mxCell id="nkDRGLkflmFNne_LrV7g-46" value="X（10172，24，2）&lt;span style=&quot;background-color: initial;&quot;&gt;Y（10172，24，2）&lt;/span&gt;" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="437" y="370" width="283" height="30" as="geometry" />
        </mxCell>
        <mxCell id="nkDRGLkflmFNne_LrV7g-47" value="在-2维度拼接得TE（10172,48,2&lt;span style=&quot;background-color: initial;&quot;&gt;）&lt;/span&gt;" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="480" y="410" width="200" height="30" as="geometry" />
        </mxCell>
        <mxCell id="nkDRGLkflmFNne_LrV7g-48" value="X是x_trains&lt;div&gt;Y是y_trainbs&lt;/div&gt;" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="170" y="410" width="110" height="30" as="geometry" />
        </mxCell>
        <mxCell id="nkDRGLkflmFNne_LrV7g-49" value="X（4，24，307，1）" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="1108" y="250" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="nkDRGLkflmFNne_LrV7g-50" value="batch_size=4" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;fontColor=#000000;darkOpacity=0.05;fillColor=#FFF9B2;strokeColor=none;fillStyle=solid;direction=west;gradientDirection=north;gradientColor=#FFF2A1;shadow=1;size=20;pointerEvents=1;" parent="1" vertex="1">
          <mxGeometry x="1248" y="20" width="81" height="50" as="geometry" />
        </mxCell>
        <mxCell id="nkDRGLkflmFNne_LrV7g-52" value="TE（4，48，2）" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="1228" y="250" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="nkDRGLkflmFNne_LrV7g-53" value="label（4，24，307，1）" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="1338" y="250" width="149" height="30" as="geometry" />
        </mxCell>
        <mxCell id="nkDRGLkflmFNne_LrV7g-55" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1273.76" y="325" as="sourcePoint" />
            <mxPoint x="1273.76" y="400" as="targetPoint" />
            <Array as="points">
              <mxPoint x="1273.76" y="355" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="nkDRGLkflmFNne_LrV7g-56" value="model（X，TE）" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="1219" y="275" width="110" height="30" as="geometry" />
        </mxCell>
        <mxCell id="nkDRGLkflmFNne_LrV7g-57" value="FC_1（in_channels=1, D=128）" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="1288" y="340" width="200" height="30" as="geometry" />
        </mxCell>
        <mxCell id="nkDRGLkflmFNne_LrV7g-58" value="X（4，24，307，128）" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="1219" y="400" width="139" height="30" as="geometry" />
        </mxCell>
        <mxCell id="nkDRGLkflmFNne_LrV7g-59" value="self.STEmbedding(self.SE&amp;lt;shape=(307,128)&amp;gt;，TE，288)" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="783" y="290" width="340" height="30" as="geometry" />
        </mxCell>
        <mxCell id="nkDRGLkflmFNne_LrV7g-60" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="943" y="320" as="sourcePoint" />
            <mxPoint x="943" y="360" as="targetPoint" />
            <Array as="points">
              <mxPoint x="943" y="350" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="nkDRGLkflmFNne_LrV7g-61" value="STE(4，48,307,128)" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="883" y="360" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="nkDRGLkflmFNne_LrV7g-64" value="STE_his(4，24,307,128)" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="873" y="390" width="160" height="30" as="geometry" />
        </mxCell>
        <mxCell id="nkDRGLkflmFNne_LrV7g-65" value="STE_pred(4，24,307,128)" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="873" y="420" width="160" height="30" as="geometry" />
        </mxCell>
        <mxCell id="nkDRGLkflmFNne_LrV7g-67" value="batch_mask_matrix(4，24,307,128)" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="1710" y="325" width="220" height="30" as="geometry" />
        </mxCell>
        <mxCell id="nkDRGLkflmFNne_LrV7g-68" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1370" y="414.5" as="sourcePoint" />
            <mxPoint x="1720" y="415" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="nkDRGLkflmFNne_LrV7g-69" value="X_miss（4，24，307，128）" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="1730" y="400" width="190" height="30" as="geometry" />
        </mxCell>
        <mxCell id="nkDRGLkflmFNne_LrV7g-70" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1273.5" y="430" as="sourcePoint" />
            <mxPoint x="1273.5" y="505" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="nkDRGLkflmFNne_LrV7g-71" value="encoder(X，STE_his,，None)" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="1298" y="450" width="182" height="30" as="geometry" />
        </mxCell>
        <mxCell id="nkDRGLkflmFNne_LrV7g-72" value="X（4，24，307，128）" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="1219" y="510" width="139" height="30" as="geometry" />
        </mxCell>
        <mxCell id="nkDRGLkflmFNne_LrV7g-74" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1370" y="524.5" as="sourcePoint" />
            <mxPoint x="1430" y="524.5" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="nkDRGLkflmFNne_LrV7g-75" value="complete_X_enc（4，24，307，128）" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="1430" y="510" width="240" height="30" as="geometry" />
        </mxCell>
        <mxCell id="nkDRGLkflmFNne_LrV7g-76" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1273.5" y="540" as="sourcePoint" />
            <mxPoint x="1273.5" y="615" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="nkDRGLkflmFNne_LrV7g-77" value="transAtt（X，STE_his，STE_pred）" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="1288" y="555" width="236" height="30" as="geometry" />
        </mxCell>
        <mxCell id="nkDRGLkflmFNne_LrV7g-79" value="X（4，24，307，128）" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="1218.5" y="620" width="139" height="30" as="geometry" />
        </mxCell>
        <mxCell id="nkDRGLkflmFNne_LrV7g-82" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1274.5" y="658" as="sourcePoint" />
            <mxPoint x="1274.5" y="733" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="nkDRGLkflmFNne_LrV7g-83" value="dncoder(X，STE_pred)" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="1299" y="678" width="132" height="30" as="geometry" />
        </mxCell>
        <mxCell id="nkDRGLkflmFNne_LrV7g-84" value="X（4，24，307，128）" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="1218.5" y="740" width="139" height="30" as="geometry" />
        </mxCell>
        <mxCell id="nkDRGLkflmFNne_LrV7g-85" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1816.5" y="432" as="sourcePoint" />
            <mxPoint x="1816.5" y="507" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="nkDRGLkflmFNne_LrV7g-86" value="encoder(X_miss，STE_his，batch_mask_matrix)" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="1841" y="452" width="269" height="30" as="geometry" />
        </mxCell>
        <mxCell id="nkDRGLkflmFNne_LrV7g-87" value="X_miss（4，24，307，128）" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="1725" y="510" width="190" height="30" as="geometry" />
        </mxCell>
        <mxCell id="nkDRGLkflmFNne_LrV7g-88" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1816.5" y="544" as="sourcePoint" />
            <mxPoint x="1816.5" y="619" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="nkDRGLkflmFNne_LrV7g-89" value="self_decoder(X_miss，STE_his，batch_mask_matrix)" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="1841" y="564" width="309" height="30" as="geometry" />
        </mxCell>
        <mxCell id="nkDRGLkflmFNne_LrV7g-90" value="X_miss（4，24，307，128）" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="1725" y="620" width="190" height="30" as="geometry" />
        </mxCell>
        <mxCell id="nkDRGLkflmFNne_LrV7g-91" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1549.5" y="540" as="sourcePoint" />
            <mxPoint x="1550" y="850" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="nkDRGLkflmFNne_LrV7g-93" value="" style="endArrow=none;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1550" y="640" as="sourcePoint" />
            <mxPoint x="1710" y="640" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="nkDRGLkflmFNne_LrV7g-94" value="loss_self" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="1510" y="860" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="nkDRGLkflmFNne_LrV7g-97" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1273.5" y="770" as="sourcePoint" />
            <mxPoint x="1273.5" y="860" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="nkDRGLkflmFNne_LrV7g-98" value="Label" style="edgeLabel;resizable=0;html=1;;align=center;verticalAlign=middle;" parent="nkDRGLkflmFNne_LrV7g-97" connectable="0" vertex="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="nkDRGLkflmFNne_LrV7g-99" value="loss_batch" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="1244" y="860" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="nkDRGLkflmFNne_LrV7g-100" value="" style="shape=partialRectangle;whiteSpace=wrap;html=1;bottom=1;right=1;left=1;top=0;fillColor=none;routingCenterX=-0.5;" parent="1" vertex="1">
          <mxGeometry x="1274" y="890" width="266" height="30" as="geometry" />
        </mxCell>
        <mxCell id="nkDRGLkflmFNne_LrV7g-101" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1406.76" y="920" as="sourcePoint" />
            <mxPoint x="1406.76" y="960" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="nkDRGLkflmFNne_LrV7g-102" value="loss_all" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="1377" y="960" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bCNiCEBLJ-j7DUpKd0t8-1" value="prepareData_SSTBAN代码中" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="240" y="100" width="210" height="60" as="geometry" />
        </mxCell>
        <mxCell id="6wLM4Py38m8FdbfmUGET-1" value="随着预测时间跨度的延长，现有模型要么无法捕捉交通数据的长期时空动态，要么以二次计算复杂性为代价配备全局感受野" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="994" y="-310" width="560" height="50" as="geometry" />
        </mxCell>
        <mxCell id="6wLM4Py38m8FdbfmUGET-2" value="其次，模型对高质量训练数据的强烈需求与其泛化能力之间的困境也是我们必须面对的挑战。" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="994" y="-260" width="530" height="40" as="geometry" />
        </mxCell>
        <mxCell id="6wLM4Py38m8FdbfmUGET-3" value="我们设计了一种时空瓶颈注意机制，在编码全局时空动力学的同时降低了计算复杂度。" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1580" y="-305" width="490" height="40" as="geometry" />
        </mxCell>
        <mxCell id="6wLM4Py38m8FdbfmUGET-10" value="&#xa;&lt;span style=&quot;color: rgb(0, 0, 0); font-family: Helvetica; font-size: 12px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: center; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; background-color: rgb(251, 251, 251); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; display: inline !important; float: none;&quot;&gt;encoder(X，STE_his,，None)&lt;/span&gt;&#xa;&#xa;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="120" y="510" width="180" height="40" as="geometry" />
        </mxCell>
        <mxCell id="6wLM4Py38m8FdbfmUGET-12" value="self.spatialAttention(X, STE, None)" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-50" y="564" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="6wLM4Py38m8FdbfmUGET-13" value="HS(4, 24, 307, 128)" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-10" y="650" width="120" height="20" as="geometry" />
        </mxCell>
        <mxCell id="6wLM4Py38m8FdbfmUGET-16" value="X(4, 24, 307, 128)&lt;div&gt;STE(4, 24, 307, 128)&lt;/div&gt;" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="330" y="515" width="139" height="30" as="geometry" />
        </mxCell>
        <mxCell id="6wLM4Py38m8FdbfmUGET-17" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="40" y="594" as="sourcePoint" />
            <mxPoint x="40" y="644" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="6wLM4Py38m8FdbfmUGET-20" value="self.temporalAttention(X, STE, None)" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="230" y="564" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="6wLM4Py38m8FdbfmUGET-21" value="HT(4, 24, 307, 128)" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="270" y="650" width="120" height="20" as="geometry" />
        </mxCell>
        <mxCell id="6wLM4Py38m8FdbfmUGET-22" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="320" y="594" as="sourcePoint" />
            <mxPoint x="320" y="644" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="6wLM4Py38m8FdbfmUGET-23" value="" style="shape=partialRectangle;whiteSpace=wrap;html=1;bottom=1;right=1;left=1;top=0;fillColor=none;routingCenterX=-0.5;" parent="1" vertex="1">
          <mxGeometry x="40" y="680" width="290" height="60" as="geometry" />
        </mxCell>
        <mxCell id="6wLM4Py38m8FdbfmUGET-29" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="184.79" y="740" as="sourcePoint" />
            <mxPoint x="184.79" y="790" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="6wLM4Py38m8FdbfmUGET-30" value="HS + HT" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="200" y="750" width="80" height="40" as="geometry" />
        </mxCell>
        <mxCell id="6wLM4Py38m8FdbfmUGET-31" value="H(4, 24, 307, 128)" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="122.5" y="790" width="125" height="30" as="geometry" />
        </mxCell>
        <mxCell id="6wLM4Py38m8FdbfmUGET-33" value="X（4， 24， 307， 128）" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="783" y="510" width="170" height="30" as="geometry" />
        </mxCell>
        <mxCell id="6wLM4Py38m8FdbfmUGET-34" value="STE_pred(41,24, 307, 128)" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="639.5" y="645" width="167" height="30" as="geometry" />
        </mxCell>
        <mxCell id="6wLM4Py38m8FdbfmUGET-36" value="STE_his(41,24, 307, 128)" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="430" y="645" width="167" height="30" as="geometry" />
        </mxCell>
        <mxCell id="6wLM4Py38m8FdbfmUGET-37" value="self.FC_q(STE_pred)" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="743" y="678" width="150" height="40" as="geometry" />
        </mxCell>
        <mxCell id="6wLM4Py38m8FdbfmUGET-40" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="723" y="675" as="sourcePoint" />
            <mxPoint x="723" y="725" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="6wLM4Py38m8FdbfmUGET-41" value="query(4, 24, 307, 128)" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="653" y="730" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="6wLM4Py38m8FdbfmUGET-45" value="self.FC_q(STE_his)" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="530" y="681" width="150" height="40" as="geometry" />
        </mxCell>
        <mxCell id="6wLM4Py38m8FdbfmUGET-46" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="510" y="678" as="sourcePoint" />
            <mxPoint x="510" y="728" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="6wLM4Py38m8FdbfmUGET-47" value="key(4, 24, 307, 128)" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="440" y="733" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="6wLM4Py38m8FdbfmUGET-48" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="723" y="763" as="sourcePoint" />
            <mxPoint x="723" y="813" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <UserObject label="torch.cat(torch.split(query, self.K, dim=-1), dim=0)" id="6wLM4Py38m8FdbfmUGET-49">
          <mxCell style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
            <mxGeometry x="723" y="763" width="300" height="40" as="geometry" />
          </mxCell>
        </UserObject>
        <mxCell id="6wLM4Py38m8FdbfmUGET-50" value="query(32, 24, 307, 16)" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="653" y="810" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="6wLM4Py38m8FdbfmUGET-53" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="510" y="766.5" as="sourcePoint" />
            <mxPoint x="510" y="816.5" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="6wLM4Py38m8FdbfmUGET-54" value="key(32, 24, 307, 16)" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="440" y="813.5" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="6wLM4Py38m8FdbfmUGET-55" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="722.64" y="840" as="sourcePoint" />
            <mxPoint x="722.64" y="890" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="6wLM4Py38m8FdbfmUGET-56" value="query(32, 307, 24, 16)" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="653" y="890" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="6wLM4Py38m8FdbfmUGET-57" value="query.permute(0, 2, 1, 3)" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="733" y="843.5" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="6wLM4Py38m8FdbfmUGET-61" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="509.64" y="838.5" as="sourcePoint" />
            <mxPoint x="509.64" y="888.5" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="6wLM4Py38m8FdbfmUGET-62" value="key(32, 307, 16, 24)" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="440" y="888.5" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="6wLM4Py38m8FdbfmUGET-63" value="key.permute(0, 2, 3, 1)" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="520" y="842" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="6wLM4Py38m8FdbfmUGET-72" value="value.permute(0, 2, 1, 3)" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1034" y="830" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="6wLM4Py38m8FdbfmUGET-73" value="X(41,24, 307, 128)" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="937" y="635" width="167" height="30" as="geometry" />
        </mxCell>
        <mxCell id="6wLM4Py38m8FdbfmUGET-74" value="self.FC_v(X)" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1044" y="671" width="150" height="40" as="geometry" />
        </mxCell>
        <mxCell id="6wLM4Py38m8FdbfmUGET-75" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1024" y="668" as="sourcePoint" />
            <mxPoint x="1024" y="718" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="6wLM4Py38m8FdbfmUGET-76" value="value(4, 24, 307, 128)" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="954" y="723" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="6wLM4Py38m8FdbfmUGET-77" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1024" y="753" as="sourcePoint" />
            <mxPoint x="1024" y="803" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="6wLM4Py38m8FdbfmUGET-78" value="value(32, 24, 307, 16)" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="954" y="800" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="6wLM4Py38m8FdbfmUGET-79" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1023.6399999999999" y="825" as="sourcePoint" />
            <mxPoint x="1023.6399999999999" y="875" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="6wLM4Py38m8FdbfmUGET-80" value="value(32, 307, 24, 16)" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="954" y="875" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="6wLM4Py38m8FdbfmUGET-81" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="509.57" y="920" as="sourcePoint" />
            <mxPoint x="510" y="1050" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="6wLM4Py38m8FdbfmUGET-82" value="" style="endArrow=none;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="720" y="918.5" as="sourcePoint" />
            <mxPoint x="510" y="990" as="targetPoint" />
            <Array as="points">
              <mxPoint x="720" y="990" />
            </Array>
          </mxGeometry>
        </mxCell>
        <UserObject label="torch.matmul(query, key)矩阵相乘，顺序有关系" id="6wLM4Py38m8FdbfmUGET-92">
          <mxCell style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
            <mxGeometry x="513" y="990" width="230" height="40" as="geometry" />
          </mxCell>
        </UserObject>
        <mxCell id="6wLM4Py38m8FdbfmUGET-93" value="attention(32, 307, 24, 24)" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="459" y="1050" width="138" height="40" as="geometry" />
        </mxCell>
        <mxCell id="6wLM4Py38m8FdbfmUGET-94" value="" style="endArrow=none;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1023" y="905" as="sourcePoint" />
            <mxPoint x="510" y="1110" as="targetPoint" />
            <Array as="points">
              <mxPoint x="1020" y="1110" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="6wLM4Py38m8FdbfmUGET-95" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="509.75" y="1080" as="sourcePoint" />
            <mxPoint x="510" y="1150" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <UserObject label="torch.matmul(attention, value)" id="6wLM4Py38m8FdbfmUGET-96">
          <mxCell style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
            <mxGeometry x="520" y="1120" width="190" height="40" as="geometry" />
          </mxCell>
        </UserObject>
        <mxCell id="6wLM4Py38m8FdbfmUGET-97" value="X(32, 307, 24, 16)" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="450" y="1150" width="138" height="40" as="geometry" />
        </mxCell>
        <mxCell id="6wLM4Py38m8FdbfmUGET-98" value="X.permute(0, 2, 1, 3)" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="520" y="1180" width="140" height="40" as="geometry" />
        </mxCell>
        <mxCell id="6wLM4Py38m8FdbfmUGET-99" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="509.64" y="1169" as="sourcePoint" />
            <mxPoint x="509.89" y="1239" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="6wLM4Py38m8FdbfmUGET-100" value="X(32, 24, 307, 16)" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="450" y="1240" width="138" height="40" as="geometry" />
        </mxCell>
        <UserObject label="torch.cat(torch.split(X, batch_size, dim=0), dim=-1)" id="6wLM4Py38m8FdbfmUGET-101">
          <mxCell style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
            <mxGeometry x="520" y="1270" width="300" height="40" as="geometry" />
          </mxCell>
        </UserObject>
        <mxCell id="6wLM4Py38m8FdbfmUGET-102" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="509.64" y="1270" as="sourcePoint" />
            <mxPoint x="510" y="1320" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="6wLM4Py38m8FdbfmUGET-103" value="X(4, 24, 307, 128)" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="450" y="1320" width="138" height="40" as="geometry" />
        </mxCell>
        <mxCell id="6wLM4Py38m8FdbfmUGET-104" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="509.64" y="1350" as="sourcePoint" />
            <mxPoint x="510" y="1400" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="6wLM4Py38m8FdbfmUGET-105" value="X(4, 24, 307, 128)" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="450" y="1400" width="138" height="40" as="geometry" />
        </mxCell>
        <mxCell id="6wLM4Py38m8FdbfmUGET-106" value="self.FC(X)" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="520" y="1350" width="90" height="40" as="geometry" />
        </mxCell>
        <mxCell id="OVFNuFVIcAY5jxq3K5aE-1" value="X（4，24，307，1）" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="1218" y="305" width="120" height="20" as="geometry" />
        </mxCell>
        <mxCell id="yw52gwobQaY5EpZ5QW9B-1" value="H = self.mab0(I, X, batch_size, &quot;spatial&quot;, mask)&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="2220" y="700" width="280" height="30" as="geometry" />
        </mxCell>
        <mxCell id="yw52gwobQaY5EpZ5QW9B-2" value="多头注意力mab0用于生成中间表示H" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="2300" y="618" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="yw52gwobQaY5EpZ5QW9B-3" value="I(4,24,3,256)&lt;div&gt;3应该是参考点个数，可减少计算复杂度&lt;/div&gt;" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="2240" y="730" width="100" height="80" as="geometry" />
        </mxCell>
        <mxCell id="yw52gwobQaY5EpZ5QW9B-4" value="X(4,24,307,256)&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="2370" y="764.5" width="100" height="37" as="geometry" />
        </mxCell>
        <mxCell id="yw52gwobQaY5EpZ5QW9B-9" value="" style="endArrow=classic;html=1;rounded=0;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="2289.8" y="801.5" as="sourcePoint" />
            <mxPoint x="2289.8" y="851.5" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="yw52gwobQaY5EpZ5QW9B-10" value="" style="endArrow=classic;html=1;rounded=0;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="2419.8" y="800" as="sourcePoint" />
            <mxPoint x="2419.8" y="850" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="yw52gwobQaY5EpZ5QW9B-11" value="Q(4,24,3,256)&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="2240" y="860" width="100" height="37" as="geometry" />
        </mxCell>
        <mxCell id="yw52gwobQaY5EpZ5QW9B-12" value="K(4,24,307,256)&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="2370" y="860" width="100" height="37" as="geometry" />
        </mxCell>
        <mxCell id="yw52gwobQaY5EpZ5QW9B-13" value="" style="endArrow=classic;html=1;rounded=0;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="2289.8" y="883.5" as="sourcePoint" />
            <mxPoint x="2289.8" y="933.5" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="yw52gwobQaY5EpZ5QW9B-14" value="self.FC_q(Q)" style="text;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="2290" y="890" width="100" height="40" as="geometry" />
        </mxCell>
        <mxCell id="yw52gwobQaY5EpZ5QW9B-15" value="" style="endArrow=classic;html=1;rounded=0;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="2410" y="883.5" as="sourcePoint" />
            <mxPoint x="2410" y="933.5" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="yw52gwobQaY5EpZ5QW9B-16" value="self.FC_k(K)" style="text;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="2410.2" y="890" width="100" height="40" as="geometry" />
        </mxCell>
        <mxCell id="yw52gwobQaY5EpZ5QW9B-17" value="" style="endArrow=classic;html=1;rounded=0;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="2540" y="880" as="sourcePoint" />
            <mxPoint x="2540" y="930" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="yw52gwobQaY5EpZ5QW9B-18" value="self.FC_v(K)" style="text;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="2540.2" y="886.5" width="100" height="40" as="geometry" />
        </mxCell>
        <mxCell id="yw52gwobQaY5EpZ5QW9B-19" value="" style="endArrow=classic;html=1;rounded=0;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="2470" y="875" as="sourcePoint" />
            <mxPoint x="2540" y="875" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="yw52gwobQaY5EpZ5QW9B-20" value="query(4,24,3,128)&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="2240" y="940" width="100" height="37" as="geometry" />
        </mxCell>
        <mxCell id="yw52gwobQaY5EpZ5QW9B-21" value="key(4,24,307,128)&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="2360" y="940" width="100" height="37" as="geometry" />
        </mxCell>
        <mxCell id="yw52gwobQaY5EpZ5QW9B-22" value="value(4,24,307,128)&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="2500" y="940" width="100" height="37" as="geometry" />
        </mxCell>
        <mxCell id="yw52gwobQaY5EpZ5QW9B-23" value="" style="endArrow=classic;html=1;rounded=0;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="2289.6" y="960" as="sourcePoint" />
            <mxPoint x="2289.6" y="1010" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <UserObject label="torch.cat(torch.split(query, self.K, dim=-1), dim=0)" id="yw52gwobQaY5EpZ5QW9B-24">
          <mxCell style="text;whiteSpace=wrap;html=1;" vertex="1" parent="1">
            <mxGeometry x="2340.2" y="970" width="300" height="40" as="geometry" />
          </mxCell>
        </UserObject>
        <mxCell id="yw52gwobQaY5EpZ5QW9B-25" value="query(32,24,3,16)&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="2240" y="1010" width="100" height="37" as="geometry" />
        </mxCell>
        <mxCell id="yw52gwobQaY5EpZ5QW9B-26" value="" style="endArrow=classic;html=1;rounded=0;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="2409.6" y="963" as="sourcePoint" />
            <mxPoint x="2409.6" y="1013" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="yw52gwobQaY5EpZ5QW9B-27" value="key(32,24,307,16)&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="2360" y="1013" width="100" height="37" as="geometry" />
        </mxCell>
        <mxCell id="yw52gwobQaY5EpZ5QW9B-28" value="" style="endArrow=classic;html=1;rounded=0;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="2549.6" y="960" as="sourcePoint" />
            <mxPoint x="2549.6" y="1010" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="yw52gwobQaY5EpZ5QW9B-29" value="value(32,24,307,16)&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="2500" y="1010" width="100" height="37" as="geometry" />
        </mxCell>
        <mxCell id="yw52gwobQaY5EpZ5QW9B-30" value="mask(4,24,307,128)&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="2520" y="750" width="100" height="37" as="geometry" />
        </mxCell>
        <mxCell id="yw52gwobQaY5EpZ5QW9B-31" value="mask(4,24,307,128)&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="2630" y="940" width="100" height="37" as="geometry" />
        </mxCell>
        <mxCell id="yw52gwobQaY5EpZ5QW9B-32" value="" style="endArrow=classic;html=1;rounded=0;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="2669.6" y="966.5" as="sourcePoint" />
            <mxPoint x="2669.6" y="1016.5" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="yw52gwobQaY5EpZ5QW9B-33" value="mask(32,24,307,16)&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="2620" y="1016.5" width="100" height="37" as="geometry" />
        </mxCell>
        <UserObject label="elif mask.shape == key.shape:" id="yw52gwobQaY5EpZ5QW9B-34">
          <mxCell style="text;whiteSpace=wrap;html=1;" vertex="1" parent="1">
            <mxGeometry x="2455" y="1047" width="190" height="40" as="geometry" />
          </mxCell>
        </UserObject>
        <mxCell id="yw52gwobQaY5EpZ5QW9B-35" value="set_mask(32,24,3,16)" style="text;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="2500" y="1070" width="130" height="40" as="geometry" />
        </mxCell>
        <mxCell id="yw52gwobQaY5EpZ5QW9B-37" value="" style="endArrow=classic;html=1;rounded=0;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="2669.8" y="1037" as="sourcePoint" />
            <mxPoint x="2670" y="1120" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="yw52gwobQaY5EpZ5QW9B-43" value="" style="endArrow=none;html=1;rounded=0;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="2620" y="1087" as="sourcePoint" />
            <mxPoint x="2670" y="1087" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="yw52gwobQaY5EpZ5QW9B-44" value="mask(32,24,3,307)&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="2630" y="1120" width="100" height="37" as="geometry" />
        </mxCell>
        <UserObject label="torch.matmul(set_mask, mask.transpose(2, 3))" id="yw52gwobQaY5EpZ5QW9B-45">
          <mxCell style="text;whiteSpace=wrap;html=1;" vertex="1" parent="1">
            <mxGeometry x="2670" y="1070" width="280" height="40" as="geometry" />
          </mxCell>
        </UserObject>
        <UserObject label="attention = torch.matmul(query, key.transpose(2, 3))&lt;br&gt;            attention /= (self.d ** 0.5)&lt;br&gt;            attention = attention.masked_fill(mask == 0, -1e9)&lt;br&gt;            attention = F.softmax(attention, dim=-1)&lt;br&gt;            result = torch.matmul(attention, value)&lt;div&gt;计算注意力得分&lt;/div&gt;&lt;div&gt;缩放得分&lt;/div&gt;&lt;div&gt;应用mask&lt;/div&gt;&lt;div&gt;经过softmax&lt;/div&gt;&lt;div&gt;得到加权后的值&lt;/div&gt;" id="yw52gwobQaY5EpZ5QW9B-46">
          <mxCell style="text;whiteSpace=wrap;html=1;" vertex="1" parent="1">
            <mxGeometry x="2350" y="1140" width="310" height="163" as="geometry" />
          </mxCell>
        </UserObject>
        <mxCell id="yw52gwobQaY5EpZ5QW9B-47" value="result(32,24,3,16)" style="text;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="2360" y="1310" width="100" height="40" as="geometry" />
        </mxCell>
        <mxCell id="yw52gwobQaY5EpZ5QW9B-48" value="" style="endArrow=classic;html=1;rounded=0;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="2400" y="1330" as="sourcePoint" />
            <mxPoint x="2400" y="1390" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="yw52gwobQaY5EpZ5QW9B-53" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="yw52gwobQaY5EpZ5QW9B-49" target="yw52gwobQaY5EpZ5QW9B-52">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="yw52gwobQaY5EpZ5QW9B-49" value="result(4,24,3,128)" style="text;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="2355" y="1390" width="100" height="40" as="geometry" />
        </mxCell>
        <UserObject label="torch.cat(torch.split(result, batch_size, dim=0), dim=-1)" id="yw52gwobQaY5EpZ5QW9B-50">
          <mxCell style="text;whiteSpace=wrap;html=1;" vertex="1" parent="1">
            <mxGeometry x="2400" y="1350" width="320" height="40" as="geometry" />
          </mxCell>
        </UserObject>
        <mxCell id="yw52gwobQaY5EpZ5QW9B-51" value="self.FC(result)" style="text;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="2420" y="1420" width="110" height="40" as="geometry" />
        </mxCell>
        <mxCell id="yw52gwobQaY5EpZ5QW9B-52" value="result(4,24,3,256)" style="text;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="2355" y="1450" width="100" height="40" as="geometry" />
        </mxCell>
        <mxCell id="yw52gwobQaY5EpZ5QW9B-54" value="多头注意力mab1&lt;div&gt;&lt;span style=&quot;color: rgb(6, 6, 7); font-family: -apple-system, blinkmacsystemfont, &amp;quot;Helvetica Neue&amp;quot;, helvetica, &amp;quot;segoe ui&amp;quot;, arial, roboto, &amp;quot;PingFang SC&amp;quot;, miui, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; letter-spacing: 0.25px; text-align: start; white-space-collapse: preserve; background-color: rgb(255, 255, 255);&quot;&gt;输出 &lt;/span&gt;&lt;code style=&quot;box-sizing: inherit; max-width: 100%; overflow: auto; white-space-collapse: preserve; font-size: 14px; text-align: justify; color: rgb(6, 6, 7); background-color: rgb(255, 255, 255); margin: 0 var(--gap-xs); padding: var(--gap-xs) var(--gap-sm); border-radius: var(--border-radius-xs); letter-spacing: 0.25px; word-break: break-word !important;&quot; class=&quot;inlineCode___uUrJ9&quot;&gt;H&lt;/code&gt;&lt;span style=&quot;color: rgb(6, 6, 7); font-family: -apple-system, blinkmacsystemfont, &amp;quot;Helvetica Neue&amp;quot;, helvetica, &amp;quot;segoe ui&amp;quot;, arial, roboto, &amp;quot;PingFang SC&amp;quot;, miui, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; letter-spacing: 0.25px; text-align: start; white-space-collapse: preserve; background-color: rgb(255, 255, 255);&quot;&gt; 和原始输入 &lt;/span&gt;&lt;code style=&quot;box-sizing: inherit; max-width: 100%; overflow: auto; white-space-collapse: preserve; font-size: 14px; text-align: justify; color: rgb(6, 6, 7); background-color: rgb(255, 255, 255); margin: 0 var(--gap-xs); padding: var(--gap-xs) var(--gap-sm); border-radius: var(--border-radius-xs); letter-spacing: 0.25px; word-break: break-word !important;&quot; class=&quot;inlineCode___uUrJ9&quot;&gt;X&lt;/code&gt;&lt;span style=&quot;color: rgb(6, 6, 7); font-family: -apple-system, blinkmacsystemfont, &amp;quot;Helvetica Neue&amp;quot;, helvetica, &amp;quot;segoe ui&amp;quot;, arial, roboto, &amp;quot;PingFang SC&amp;quot;, miui, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;Microsoft Yahei&amp;quot;, sans-serif; font-size: 14px; letter-spacing: 0.25px; text-align: start; white-space-collapse: preserve; background-color: rgb(255, 255, 255);&quot;&gt; 进一步细化注意力加权值&lt;/span&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="2680" y="1390" width="140" height="90" as="geometry" />
        </mxCell>
        <mxCell id="yw52gwobQaY5EpZ5QW9B-55" value="self.mab1(X, H, batch_size, &quot;spatial&quot;, mask)" style="text;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="2625" y="1510" width="270" height="40" as="geometry" />
        </mxCell>
        <mxCell id="yw52gwobQaY5EpZ5QW9B-56" value="X(4,24,307,256)&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="2620" y="1560" width="100" height="37" as="geometry" />
        </mxCell>
        <mxCell id="yw52gwobQaY5EpZ5QW9B-57" value="H(4,24,3,256)" style="text;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="2740" y="1557" width="100" height="40" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
